/* $Id$
 *
 * charset_internal : 
 *	standalone character set conversions (do not require iconv)
 *	between UTF-8 <-> 1-byte charsets / codepages.
 *
 * File "charset.c" copied from "siefs" v0.5 
 * ( http://chaos.allsiemens.com/siefs/ )
 * (C) Dmitry Zakharov aka ChaoS <dmitry-z@mail.ru>
 *
 * Modified for djmount (C) 2005, Rémi Turboult <r3mi@users.sourceforge.net>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 */

#include "charset_internal.h"

#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include <stdint.h>

static const uint16_t c2u_cp1250[128] = {
	0x20ac, 0x0000, 0x201a, 0x0000,
	0x201e, 0x2026, 0x2020, 0x2021,
	0x0000, 0x2030, 0x0160, 0x2039,
	0x015a, 0x0164, 0x017d, 0x0179,
	0x0000, 0x2018, 0x2019, 0x201c,
	0x201d, 0x2022, 0x2013, 0x2014,
	0x0000, 0x2122, 0x0161, 0x203a,
	0x015b, 0x0165, 0x017e, 0x017a,
	0x00a0, 0x02c7, 0x02d8, 0x0141,
	0x00a4, 0x0104, 0x00a6, 0x00a7,
	0x00a8, 0x00a9, 0x015e, 0x00ab,
	0x00ac, 0x00ad, 0x00ae, 0x017b,
	0x00b0, 0x00b1, 0x02db, 0x0142,
	0x00b4, 0x00b5, 0x00b6, 0x00b7,
	0x00b8, 0x0105, 0x015f, 0x00bb,
	0x013d, 0x02dd, 0x013e, 0x017c,
	0x0154, 0x00c1, 0x00c2, 0x0102,
	0x00c4, 0x0139, 0x0106, 0x00c7,
	0x010c, 0x00c9, 0x0118, 0x00cb,
	0x011a, 0x00cd, 0x00ce, 0x010e,
	0x0110, 0x0143, 0x0147, 0x00d3,
	0x00d4, 0x0150, 0x00d6, 0x00d7,
	0x0158, 0x016e, 0x00da, 0x0170,
	0x00dc, 0x00dd, 0x0162, 0x00df,
	0x0155, 0x00e1, 0x00e2, 0x0103,
	0x00e4, 0x013a, 0x0107, 0x00e7,
	0x010d, 0x00e9, 0x0119, 0x00eb,
	0x011b, 0x00ed, 0x00ee, 0x010f,
	0x0111, 0x0144, 0x0148, 0x00f3,
	0x00f4, 0x0151, 0x00f6, 0x00f7,
	0x0159, 0x016f, 0x00fa, 0x0171,
	0x00fc, 0x00fd, 0x0163, 0x02d9,
};

static const uint16_t c2u_cp1251[128] = {
	0x0402, 0x0403, 0x201a, 0x0453,
	0x201e, 0x2026, 0x2020, 0x2021,
	0x20ac, 0x2030, 0x0409, 0x2039,
	0x040a, 0x040c, 0x040b, 0x040f,
	0x0452, 0x2018, 0x2019, 0x201c,
	0x201d, 0x2022, 0x2013, 0x2014,
	0x0000, 0x2122, 0x0459, 0x203a,
	0x045a, 0x045c, 0x045b, 0x045f,
	0x00a0, 0x040e, 0x045e, 0x0408,
	0x00a4, 0x0490, 0x00a6, 0x00a7,
	0x0401, 0x00a9, 0x0404, 0x00ab,
	0x00ac, 0x00ad, 0x00ae, 0x0407,
	0x00b0, 0x00b1, 0x0406, 0x0456,
	0x0491, 0x00b5, 0x00b6, 0x00b7,
	0x0451, 0x2116, 0x0454, 0x00bb,
	0x0458, 0x0405, 0x0455, 0x0457,
	0x0410, 0x0411, 0x0412, 0x0413,
	0x0414, 0x0415, 0x0416, 0x0417,
	0x0418, 0x0419, 0x041a, 0x041b,
	0x041c, 0x041d, 0x041e, 0x041f,
	0x0420, 0x0421, 0x0422, 0x0423,
	0x0424, 0x0425, 0x0426, 0x0427,
	0x0428, 0x0429, 0x042a, 0x042b,
	0x042c, 0x042d, 0x042e, 0x042f,
	0x0430, 0x0431, 0x0432, 0x0433,
	0x0434, 0x0435, 0x0436, 0x0437,
	0x0438, 0x0439, 0x043a, 0x043b,
	0x043c, 0x043d, 0x043e, 0x043f,
	0x0440, 0x0441, 0x0442, 0x0443,
	0x0444, 0x0445, 0x0446, 0x0447,
	0x0448, 0x0449, 0x044a, 0x044b,
	0x044c, 0x044d, 0x044e, 0x044f,
};

static const uint16_t c2u_cp1255[128] = {
	0x20ac, 0x0000, 0x201a, 0x0192,
	0x201e, 0x2026, 0x2020, 0x2021,
	0x02c6, 0x2030, 0x0000, 0x2039,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x2018, 0x2019, 0x201c,
	0x201d, 0x2022, 0x2013, 0x2014,
	0x02dc, 0x2122, 0x0000, 0x203a,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x00a0, 0x00a1, 0x00a2, 0x00a3,
	0x20aa, 0x00a5, 0x00a6, 0x00a7,
	0x00a8, 0x00a9, 0x00d7, 0x00ab,
	0x00ac, 0x00ad, 0x00ae, 0x203e,
	0x00b0, 0x00b1, 0x00b2, 0x00b3,
	0x00b4, 0x00b5, 0x00b6, 0x00b7,
	0x00b8, 0x00b9, 0x00f7, 0x00bb,
	0x00bc, 0x00bd, 0x00be, 0x00bf,
	0x05b0, 0x05b1, 0x05b2, 0x05b3,
	0x05b4, 0x05b5, 0x05b6, 0x05b7,
	0x05b8, 0x05b9, 0x0000, 0x05bb,
	0x05bc, 0x05bd, 0x05be, 0x05bf,
	0x05c0, 0x05c1, 0x05c2, 0x05c3,
	0x05f0, 0x05f1, 0x05f2, 0x05f3,
	0x05f4, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x2017,
	0x05d0, 0x05d1, 0x05d2, 0x05d3,
	0x05d4, 0x05d5, 0x05d6, 0x05d7,
	0x05d8, 0x05d9, 0x05da, 0x05db,
	0x05dc, 0x05dd, 0x05de, 0x05df,
	0x05e0, 0x05e1, 0x05e2, 0x05e3,
	0x05e4, 0x05e5, 0x05e6, 0x05e7,
	0x05e8, 0x05e9, 0x05ea, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
};

static const uint16_t c2u_cp437[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00e4, 0x00e0, 0x00e5, 0x00e7,
	0x00ea, 0x00eb, 0x00e8, 0x00ef,
	0x00ee, 0x00ec, 0x00c4, 0x00c5,
	0x00c9, 0x00e6, 0x00c6, 0x00f4,
	0x00f6, 0x00f2, 0x00fb, 0x00f9,
	0x00ff, 0x00d6, 0x00dc, 0x00a2,
	0x00a3, 0x00a5, 0x20a7, 0x0192,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x00f1, 0x00d1, 0x00aa, 0x00ba,
	0x00bf, 0x2310, 0x00ac, 0x00bd,
	0x00bc, 0x00a1, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x03b1, 0x00df, 0x0393, 0x03c0,
	0x03a3, 0x03c3, 0x00b5, 0x03c4,
	0x03a6, 0x0398, 0x03a9, 0x03b4,
	0x221e, 0x03c6, 0x03b5, 0x2229,
	0x2261, 0x00b1, 0x2265, 0x2264,
	0x2320, 0x2321, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x207f, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp737[128] = {
	0x0391, 0x0392, 0x0393, 0x0394,
	0x0395, 0x0396, 0x0397, 0x0398,
	0x0399, 0x039a, 0x039b, 0x039c,
	0x039d, 0x039e, 0x039f, 0x03a0,
	0x03a1, 0x03a3, 0x03a4, 0x03a5,
	0x03a6, 0x03a7, 0x03a8, 0x03a9,
	0x03b1, 0x03b2, 0x03b3, 0x03b4,
	0x03b5, 0x03b6, 0x03b7, 0x03b8,
	0x03b9, 0x03ba, 0x03bb, 0x03bc,
	0x03bd, 0x03be, 0x03bf, 0x03c0,
	0x03c1, 0x03c3, 0x03c2, 0x03c4,
	0x03c5, 0x03c6, 0x03c7, 0x03c8,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x03c9, 0x03ac, 0x03ad, 0x03ae,
	0x03ca, 0x03af, 0x03cc, 0x03cd,
	0x03cb, 0x03ce, 0x0386, 0x0388,
	0x0389, 0x038a, 0x038c, 0x038e,
	0x038f, 0x00b1, 0x2265, 0x2264,
	0x03aa, 0x03ab, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x207f, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp775[128] = {
	0x0106, 0x00fc, 0x00e9, 0x0101,
	0x00e4, 0x0123, 0x00e5, 0x0107,
	0x0142, 0x0113, 0x0156, 0x0157,
	0x012b, 0x0179, 0x00c4, 0x00c5,
	0x00c9, 0x00e6, 0x00c6, 0x014d,
	0x00f6, 0x0122, 0x00a2, 0x015a,
	0x015b, 0x00d6, 0x00dc, 0x00f8,
	0x00a3, 0x00d8, 0x00d7, 0x00a4,
	0x0100, 0x012a, 0x00f3, 0x017b,
	0x017c, 0x017a, 0x201d, 0x00a6,
	0x00a9, 0x00ae, 0x00ac, 0x00bd,
	0x00bc, 0x0141, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x0104, 0x010c, 0x0118,
	0x0116, 0x2563, 0x2551, 0x2557,
	0x255d, 0x012e, 0x0160, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x0172, 0x016a,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x017d,
	0x0105, 0x010d, 0x0119, 0x0117,
	0x012f, 0x0161, 0x0173, 0x016b,
	0x017e, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x00d3, 0x00df, 0x014c, 0x0143,
	0x00f5, 0x00d5, 0x00b5, 0x0144,
	0x0136, 0x0137, 0x013b, 0x013c,
	0x0146, 0x0112, 0x0145, 0x2019,
	0x00ad, 0x00b1, 0x201c, 0x00be,
	0x00b6, 0x00a7, 0x00f7, 0x201e,
	0x00b0, 0x2219, 0x00b7, 0x00b9,
	0x00b3, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp850[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00e4, 0x00e0, 0x00e5, 0x00e7,
	0x00ea, 0x00eb, 0x00e8, 0x00ef,
	0x00ee, 0x00ec, 0x00c4, 0x00c5,
	0x00c9, 0x00e6, 0x00c6, 0x00f4,
	0x00f6, 0x00f2, 0x00fb, 0x00f9,
	0x00ff, 0x00d6, 0x00dc, 0x00f8,
	0x00a3, 0x00d8, 0x00d7, 0x0192,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x00f1, 0x00d1, 0x00aa, 0x00ba,
	0x00bf, 0x00ae, 0x00ac, 0x00bd,
	0x00bc, 0x00a1, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x00c1, 0x00c2, 0x00c0,
	0x00a9, 0x2563, 0x2551, 0x2557,
	0x255d, 0x00a2, 0x00a5, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x00e3, 0x00c3,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x00a4,
	0x00f0, 0x00d0, 0x00ca, 0x00cb,
	0x00c8, 0x0131, 0x00cd, 0x00ce,
	0x00cf, 0x2518, 0x250c, 0x2588,
	0x2584, 0x00a6, 0x00cc, 0x2580,
	0x00d3, 0x00df, 0x00d4, 0x00d2,
	0x00f5, 0x00d5, 0x00b5, 0x00fe,
	0x00de, 0x00da, 0x00db, 0x00d9,
	0x00fd, 0x00dd, 0x00af, 0x00b4,
	0x00ad, 0x00b1, 0x2017, 0x00be,
	0x00b6, 0x00a7, 0x00f7, 0x00b8,
	0x00b0, 0x00a8, 0x00b7, 0x00b9,
	0x00b3, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp852[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00e4, 0x016f, 0x0107, 0x00e7,
	0x0142, 0x00eb, 0x0150, 0x0151,
	0x00ee, 0x0179, 0x00c4, 0x0106,
	0x00c9, 0x0139, 0x013a, 0x00f4,
	0x00f6, 0x013d, 0x013e, 0x015a,
	0x015b, 0x00d6, 0x00dc, 0x0164,
	0x0165, 0x0141, 0x00d7, 0x010d,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x0104, 0x0105, 0x017d, 0x017e,
	0x0118, 0x0119, 0x00ac, 0x017a,
	0x010c, 0x015f, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x00c1, 0x00c2, 0x011a,
	0x015e, 0x2563, 0x2551, 0x2557,
	0x255d, 0x017b, 0x017c, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x0102, 0x0103,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x00a4,
	0x0111, 0x0110, 0x010e, 0x00cb,
	0x010f, 0x0147, 0x00cd, 0x00ce,
	0x011b, 0x2518, 0x250c, 0x2588,
	0x2584, 0x0162, 0x016e, 0x2580,
	0x00d3, 0x00df, 0x00d4, 0x0143,
	0x0144, 0x0148, 0x0160, 0x0161,
	0x0154, 0x00da, 0x0155, 0x0170,
	0x00fd, 0x00dd, 0x0163, 0x00b4,
	0x00ad, 0x02dd, 0x02db, 0x02c7,
	0x02d8, 0x00a7, 0x00f7, 0x00b8,
	0x00b0, 0x00a8, 0x02d9, 0x0171,
	0x0158, 0x0159, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp855[128] = {
	0x0452, 0x0402, 0x0453, 0x0403,
	0x0451, 0x0401, 0x0454, 0x0404,
	0x0455, 0x0405, 0x0456, 0x0406,
	0x0457, 0x0407, 0x0458, 0x0408,
	0x0459, 0x0409, 0x045a, 0x040a,
	0x045b, 0x040b, 0x045c, 0x040c,
	0x045e, 0x040e, 0x045f, 0x040f,
	0x044e, 0x042e, 0x044a, 0x042a,
	0x0430, 0x0410, 0x0431, 0x0411,
	0x0446, 0x0426, 0x0434, 0x0414,
	0x0435, 0x0415, 0x0444, 0x0424,
	0x0433, 0x0413, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x0445, 0x0425, 0x0438,
	0x0418, 0x2563, 0x2551, 0x2557,
	0x255d, 0x0439, 0x0419, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x043a, 0x041a,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x00a4,
	0x043b, 0x041b, 0x043c, 0x041c,
	0x043d, 0x041d, 0x043e, 0x041e,
	0x043f, 0x2518, 0x250c, 0x2588,
	0x2584, 0x041f, 0x044f, 0x2580,
	0x042f, 0x0440, 0x0420, 0x0441,
	0x0421, 0x0442, 0x0422, 0x0443,
	0x0423, 0x0436, 0x0416, 0x0432,
	0x0412, 0x044c, 0x042c, 0x2116,
	0x00ad, 0x044b, 0x042b, 0x0437,
	0x0417, 0x0448, 0x0428, 0x044d,
	0x042d, 0x0449, 0x0429, 0x0447,
	0x0427, 0x00a7, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp857[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00e4, 0x00e0, 0x00e5, 0x00e7,
	0x00ea, 0x00eb, 0x00e8, 0x00ef,
	0x00ee, 0x0131, 0x00c4, 0x00c5,
	0x00c9, 0x00e6, 0x00c6, 0x00f4,
	0x00f6, 0x00f2, 0x00fb, 0x00f9,
	0x0130, 0x00d6, 0x00dc, 0x00f8,
	0x00a3, 0x00d8, 0x015e, 0x015f,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x00f1, 0x00d1, 0x011e, 0x011f,
	0x00bf, 0x00ae, 0x00ac, 0x00bd,
	0x00bc, 0x00a1, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x00c1, 0x00c2, 0x00c0,
	0x00a9, 0x2563, 0x2551, 0x2557,
	0x255d, 0x00a2, 0x00a5, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x00e3, 0x00c3,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x00a4,
	0x00ba, 0x00aa, 0x00ca, 0x00cb,
	0x00c8, 0x0000, 0x00cd, 0x00ce,
	0x00cf, 0x2518, 0x250c, 0x2588,
	0x2584, 0x00a6, 0x00cc, 0x2580,
	0x00d3, 0x00df, 0x00d4, 0x00d2,
	0x00f5, 0x00d5, 0x00b5, 0x0000,
	0x00d7, 0x00da, 0x00db, 0x00d9,
	0x00ec, 0x00ff, 0x00af, 0x00b4,
	0x00ad, 0x00b1, 0x0000, 0x00be,
	0x00b6, 0x00a7, 0x00f7, 0x00b8,
	0x00b0, 0x00a8, 0x00b7, 0x00b9,
	0x00b3, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp860[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00e3, 0x00e0, 0x00c1, 0x00e7,
	0x00ea, 0x00ca, 0x00e8, 0x00cd,
	0x00d4, 0x00ec, 0x00c3, 0x00c2,
	0x00c9, 0x00c0, 0x00c8, 0x00f4,
	0x00f5, 0x00f2, 0x00da, 0x00f9,
	0x00cc, 0x00d5, 0x00dc, 0x00a2,
	0x00a3, 0x00d9, 0x20a7, 0x00d3,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x00f1, 0x00d1, 0x00aa, 0x00ba,
	0x00bf, 0x00d2, 0x00ac, 0x00bd,
	0x00bc, 0x00a1, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x03b1, 0x00df, 0x0393, 0x03c0,
	0x03a3, 0x03c3, 0x00b5, 0x03c4,
	0x03a6, 0x0398, 0x03a9, 0x03b4,
	0x221e, 0x03c6, 0x03b5, 0x2229,
	0x2261, 0x00b1, 0x2265, 0x2264,
	0x2320, 0x2321, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x207f, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp861[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00e4, 0x00e0, 0x00e5, 0x00e7,
	0x00ea, 0x00eb, 0x00e8, 0x00d0,
	0x00f0, 0x00de, 0x00c4, 0x00c5,
	0x00c9, 0x00e6, 0x00c6, 0x00f4,
	0x00f6, 0x00fe, 0x00fb, 0x00dd,
	0x00fd, 0x00d6, 0x00dc, 0x00f8,
	0x00a3, 0x00d8, 0x20a7, 0x0192,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x00c1, 0x00cd, 0x00d3, 0x00da,
	0x00bf, 0x2310, 0x00ac, 0x00bd,
	0x00bc, 0x00a1, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x03b1, 0x00df, 0x0393, 0x03c0,
	0x03a3, 0x03c3, 0x00b5, 0x03c4,
	0x03a6, 0x0398, 0x03a9, 0x03b4,
	0x221e, 0x03c6, 0x03b5, 0x2229,
	0x2261, 0x00b1, 0x2265, 0x2264,
	0x2320, 0x2321, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x207f, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp862[128] = {
	0x05d0, 0x05d1, 0x05d2, 0x05d3,
	0x05d4, 0x05d5, 0x05d6, 0x05d7,
	0x05d8, 0x05d9, 0x05da, 0x05db,
	0x05dc, 0x05dd, 0x05de, 0x05df,
	0x05e0, 0x05e1, 0x05e2, 0x05e3,
	0x05e4, 0x05e5, 0x05e6, 0x05e7,
	0x05e8, 0x05e9, 0x05ea, 0x00a2,
	0x00a3, 0x00a5, 0x20a7, 0x0192,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x00f1, 0x00d1, 0x00aa, 0x00ba,
	0x00bf, 0x2310, 0x00ac, 0x00bd,
	0x00bc, 0x00a1, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x03b1, 0x00df, 0x0393, 0x03c0,
	0x03a3, 0x03c3, 0x00b5, 0x03c4,
	0x03a6, 0x0398, 0x03a9, 0x03b4,
	0x221e, 0x03c6, 0x03b5, 0x2229,
	0x2261, 0x00b1, 0x2265, 0x2264,
	0x2320, 0x2321, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x207f, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp863[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00c2, 0x00e0, 0x00b6, 0x00e7,
	0x00ea, 0x00eb, 0x00e8, 0x00ef,
	0x00ee, 0x2017, 0x00c0, 0x00a7,
	0x00c9, 0x00c8, 0x00ca, 0x00f4,
	0x00cb, 0x00cf, 0x00fb, 0x00f9,
	0x00a4, 0x00d4, 0x00dc, 0x00a2,
	0x00a3, 0x00d9, 0x00db, 0x0192,
	0x00a6, 0x00b4, 0x00f3, 0x00fa,
	0x00a8, 0x00b8, 0x00b3, 0x00af,
	0x00ce, 0x2310, 0x00ac, 0x00bd,
	0x00bc, 0x00be, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x03b1, 0x00df, 0x0393, 0x03c0,
	0x03a3, 0x03c3, 0x00b5, 0x03c4,
	0x03a6, 0x0398, 0x03a9, 0x03b4,
	0x221e, 0x03c6, 0x03b5, 0x2229,
	0x2261, 0x00b1, 0x2265, 0x2264,
	0x2320, 0x2321, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x207f, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp864[128] = {
	0x00b0, 0x00b7, 0x2219, 0x221a,
	0x2592, 0x2500, 0x2502, 0x253c,
	0x2524, 0x252c, 0x251c, 0x2534,
	0x2510, 0x250c, 0x2514, 0x2518,
	0x03b2, 0x221e, 0x03c6, 0x00b1,
	0x00bd, 0x00bc, 0x2248, 0x00ab,
	0x00bb, 0xfef7, 0xfef8, 0x0000,
	0x0000, 0xfefb, 0xfefc, 0x0000,
	0x00a0, 0x00ad, 0xfe82, 0x00a3,
	0x00a4, 0xfe84, 0x0000, 0x0000,
	0xfe8e, 0xfe8f, 0xfe95, 0xfe99,
	0x060c, 0xfe9d, 0xfea1, 0xfea5,
	0x0660, 0x0661, 0x0662, 0x0663,
	0x0664, 0x0665, 0x0666, 0x0667,
	0x0668, 0x0669, 0xfed1, 0x061b,
	0xfeb1, 0xfeb5, 0xfeb9, 0x061f,
	0x00a2, 0xfe80, 0xfe81, 0xfe83,
	0xfe85, 0xfeca, 0xfe8b, 0xfe8d,
	0xfe91, 0xfe93, 0xfe97, 0xfe9b,
	0xfe9f, 0xfea3, 0xfea7, 0xfea9,
	0xfeab, 0xfead, 0xfeaf, 0xfeb3,
	0xfeb7, 0xfebb, 0xfebf, 0xfec1,
	0xfec5, 0xfecb, 0xfecf, 0x00a6,
	0x00ac, 0x00f7, 0x00d7, 0xfec9,
	0x0640, 0xfed3, 0xfed7, 0xfedb,
	0xfedf, 0xfee3, 0xfee7, 0xfeeb,
	0xfeed, 0xfeef, 0xfef3, 0xfebd,
	0xfecc, 0xfece, 0xfecd, 0xfee1,
	0xfe7d, 0x0651, 0xfee5, 0xfee9,
	0xfeec, 0xfef0, 0xfef2, 0xfed0,
	0xfed5, 0xfef5, 0xfef6, 0xfedd,
	0xfed9, 0xfef1, 0x25a0, 0x0000,
};

static const uint16_t c2u_cp865[128] = {
	0x00c7, 0x00fc, 0x00e9, 0x00e2,
	0x00e4, 0x00e0, 0x00e5, 0x00e7,
	0x00ea, 0x00eb, 0x00e8, 0x00ef,
	0x00ee, 0x00ec, 0x00c4, 0x00c5,
	0x00c9, 0x00e6, 0x00c6, 0x00f4,
	0x00f6, 0x00f2, 0x00fb, 0x00f9,
	0x00ff, 0x00d6, 0x00dc, 0x00f8,
	0x00a3, 0x00d8, 0x20a7, 0x0192,
	0x00e1, 0x00ed, 0x00f3, 0x00fa,
	0x00f1, 0x00d1, 0x00aa, 0x00ba,
	0x00bf, 0x2310, 0x00ac, 0x00bd,
	0x00bc, 0x00a1, 0x00ab, 0x00a4,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x03b1, 0x00df, 0x0393, 0x03c0,
	0x03a3, 0x03c3, 0x00b5, 0x03c4,
	0x03a6, 0x0398, 0x03a9, 0x03b4,
	0x221e, 0x03c6, 0x03b5, 0x2229,
	0x2261, 0x00b1, 0x2265, 0x2264,
	0x2320, 0x2321, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x207f, 0x00b2, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp866[128] = {
	0x0410, 0x0411, 0x0412, 0x0413,
	0x0414, 0x0415, 0x0416, 0x0417,
	0x0418, 0x0419, 0x041a, 0x041b,
	0x041c, 0x041d, 0x041e, 0x041f,
	0x0420, 0x0421, 0x0422, 0x0423,
	0x0424, 0x0425, 0x0426, 0x0427,
	0x0428, 0x0429, 0x042a, 0x042b,
	0x042c, 0x042d, 0x042e, 0x042f,
	0x0430, 0x0431, 0x0432, 0x0433,
	0x0434, 0x0435, 0x0436, 0x0437,
	0x0438, 0x0439, 0x043a, 0x043b,
	0x043c, 0x043d, 0x043e, 0x043f,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557,
	0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559,
	0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588,
	0x2584, 0x258c, 0x2590, 0x2580,
	0x0440, 0x0441, 0x0442, 0x0443,
	0x0444, 0x0445, 0x0446, 0x0447,
	0x0448, 0x0449, 0x044a, 0x044b,
	0x044c, 0x044d, 0x044e, 0x044f,
	0x0401, 0x0451, 0x0404, 0x0454,
	0x0407, 0x0457, 0x040e, 0x045e,
	0x00b0, 0x2219, 0x00b7, 0x221a,
	0x2116, 0x00a4, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp869[128] = {
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0386, 0x0000,
	0x00b7, 0x00ac, 0x00a6, 0x2018,
	0x2019, 0x0388, 0x2015, 0x0389,
	0x038a, 0x03aa, 0x038c, 0x0000,
	0x0000, 0x038e, 0x03ab, 0x00a9,
	0x038f, 0x00b2, 0x00b3, 0x03ac,
	0x00a3, 0x03ad, 0x03ae, 0x03af,
	0x03ca, 0x0390, 0x03cc, 0x03cd,
	0x0391, 0x0392, 0x0393, 0x0394,
	0x0395, 0x0396, 0x0397, 0x00bd,
	0x0398, 0x0399, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502,
	0x2524, 0x039a, 0x039b, 0x039c,
	0x039d, 0x2563, 0x2551, 0x2557,
	0x255d, 0x039e, 0x039f, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c,
	0x2500, 0x253c, 0x03a0, 0x03a1,
	0x255a, 0x2554, 0x2569, 0x2566,
	0x2560, 0x2550, 0x256c, 0x03a3,
	0x03a4, 0x03a5, 0x03a6, 0x03a7,
	0x03a8, 0x03a9, 0x03b1, 0x03b2,
	0x03b3, 0x2518, 0x250c, 0x2588,
	0x2584, 0x03b4, 0x03b5, 0x2580,
	0x03b6, 0x03b7, 0x03b8, 0x03b9,
	0x03ba, 0x03bb, 0x03bc, 0x03bd,
	0x03be, 0x03bf, 0x03c0, 0x03c1,
	0x03c3, 0x03c2, 0x03c4, 0x0384,
	0x00ad, 0x00b1, 0x03c5, 0x03c6,
	0x03c7, 0x00a7, 0x03c8, 0x0385,
	0x00b0, 0x00a8, 0x03c9, 0x03cb,
	0x03b0, 0x03ce, 0x25a0, 0x00a0,
};

static const uint16_t c2u_cp874[128] = {
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x2026, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x2018, 0x2019, 0x201c,
	0x201d, 0x2022, 0x2013, 0x2014,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x00a0, 0x0e01, 0x0e02, 0x0e03,
	0x0e04, 0x0e05, 0x0e06, 0x0e07,
	0x0e08, 0x0e09, 0x0e0a, 0x0e0b,
	0x0e0c, 0x0e0d, 0x0e0e, 0x0e0f,
	0x0e10, 0x0e11, 0x0e12, 0x0e13,
	0x0e14, 0x0e15, 0x0e16, 0x0e17,
	0x0e18, 0x0e19, 0x0e1a, 0x0e1b,
	0x0e1c, 0x0e1d, 0x0e1e, 0x0e1f,
	0x0e20, 0x0e21, 0x0e22, 0x0e23,
	0x0e24, 0x0e25, 0x0e26, 0x0e27,
	0x0e28, 0x0e29, 0x0e2a, 0x0e2b,
	0x0e2c, 0x0e2d, 0x0e2e, 0x0e2f,
	0x0e30, 0x0e31, 0x0e32, 0x0e33,
	0x0e34, 0x0e35, 0x0e36, 0x0e37,
	0x0e38, 0x0e39, 0x0e3a, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0e3f,
	0x0e40, 0x0e41, 0x0e42, 0x0e43,
	0x0e44, 0x0e45, 0x0e46, 0x0e47,
	0x0e48, 0x0e49, 0x0e4a, 0x0e4b,
	0x0e4c, 0x0e4d, 0x0e4e, 0x0e4f,
	0x0e50, 0x0e51, 0x0e52, 0x0e53,
	0x0e54, 0x0e55, 0x0e56, 0x0e57,
	0x0e58, 0x0e59, 0x0e5a, 0x0e5b,
	0x0000, 0x0000, 0x0000, 0x0000,
};

static const uint16_t c2u_iso8859_1[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x00a1, 0x00a2, 0x00a3,
	0x00a4, 0x00a5, 0x00a6, 0x00a7,
	0x00a8, 0x00a9, 0x00aa, 0x00ab,
	0x00ac, 0x00ad, 0x00ae, 0x00af,
	0x00b0, 0x00b1, 0x00b2, 0x00b3,
	0x00b4, 0x00b5, 0x00b6, 0x00b7,
	0x00b8, 0x00b9, 0x00ba, 0x00bb,
	0x00bc, 0x00bd, 0x00be, 0x00bf,
	0x00c0, 0x00c1, 0x00c2, 0x00c3,
	0x00c4, 0x00c5, 0x00c6, 0x00c7,
	0x00c8, 0x00c9, 0x00ca, 0x00cb,
	0x00cc, 0x00cd, 0x00ce, 0x00cf,
	0x00d0, 0x00d1, 0x00d2, 0x00d3,
	0x00d4, 0x00d5, 0x00d6, 0x00d7,
	0x00d8, 0x00d9, 0x00da, 0x00db,
	0x00dc, 0x00dd, 0x00de, 0x00df,
	0x00e0, 0x00e1, 0x00e2, 0x00e3,
	0x00e4, 0x00e5, 0x00e6, 0x00e7,
	0x00e8, 0x00e9, 0x00ea, 0x00eb,
	0x00ec, 0x00ed, 0x00ee, 0x00ef,
	0x00f0, 0x00f1, 0x00f2, 0x00f3,
	0x00f4, 0x00f5, 0x00f6, 0x00f7,
	0x00f8, 0x00f9, 0x00fa, 0x00fb,
	0x00fc, 0x00fd, 0x00fe, 0x00ff,
};

static const uint16_t c2u_iso8859_13[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x201d, 0x00a2, 0x00a3,
	0x00a4, 0x201e, 0x00a6, 0x00a7,
	0x00d8, 0x00a9, 0x0156, 0x00ab,
	0x00ac, 0x00ad, 0x00ae, 0x00c6,
	0x00b0, 0x00b1, 0x00b2, 0x00b3,
	0x201c, 0x00b5, 0x00b6, 0x00b7,
	0x00f8, 0x00b9, 0x0157, 0x00bb,
	0x00bc, 0x00bd, 0x00be, 0x00e6,
	0x0104, 0x012e, 0x0100, 0x0106,
	0x00c4, 0x00c5, 0x0118, 0x0112,
	0x010c, 0x00c9, 0x0179, 0x0116,
	0x0122, 0x0136, 0x012a, 0x013b,
	0x0160, 0x0143, 0x0145, 0x00d3,
	0x014c, 0x00d5, 0x00d6, 0x00d7,
	0x0172, 0x0141, 0x015a, 0x016a,
	0x00dc, 0x017b, 0x017d, 0x00df,
	0x0105, 0x012f, 0x0101, 0x0107,
	0x00e4, 0x00e5, 0x0119, 0x0113,
	0x010d, 0x00e9, 0x017a, 0x0117,
	0x0123, 0x0137, 0x012b, 0x013c,
	0x0161, 0x0144, 0x0146, 0x00f3,
	0x014d, 0x00f5, 0x00f6, 0x00f7,
	0x0173, 0x0142, 0x015b, 0x016b,
	0x00fc, 0x017c, 0x017e, 0x2019,
};

static const uint16_t c2u_iso8859_14[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x1e02, 0x1e03, 0x00a3,
	0x010a, 0x010b, 0x1e0a, 0x00a7,
	0x1e80, 0x00a9, 0x1e82, 0x1e0b,
	0x1ef2, 0x00ad, 0x00ae, 0x0178,
	0x1e1e, 0x1e1f, 0x0120, 0x0121,
	0x1e40, 0x1e41, 0x00b6, 0x1e56,
	0x1e81, 0x1e57, 0x1e83, 0x1e60,
	0x1ef3, 0x1e84, 0x1e85, 0x1e61,
	0x00c0, 0x00c1, 0x00c2, 0x00c3,
	0x00c4, 0x00c5, 0x00c6, 0x00c7,
	0x00c8, 0x00c9, 0x00ca, 0x00cb,
	0x00cc, 0x00cd, 0x00ce, 0x00cf,
	0x0174, 0x00d1, 0x00d2, 0x00d3,
	0x00d4, 0x00d5, 0x00d6, 0x1e6a,
	0x00d8, 0x00d9, 0x00da, 0x00db,
	0x00dc, 0x00dd, 0x0176, 0x00df,
	0x00e0, 0x00e1, 0x00e2, 0x00e3,
	0x00e4, 0x00e5, 0x00e6, 0x00e7,
	0x00e8, 0x00e9, 0x00ea, 0x00eb,
	0x00ec, 0x00ed, 0x00ee, 0x00ef,
	0x0175, 0x00f1, 0x00f2, 0x00f3,
	0x00f4, 0x00f5, 0x00f6, 0x1e6b,
	0x00f8, 0x00f9, 0x00fa, 0x00fb,
	0x00fc, 0x00fd, 0x0177, 0x00ff,
};

static const uint16_t c2u_iso8859_15[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x00a1, 0x00a2, 0x00a3,
	0x20ac, 0x00a5, 0x0160, 0x00a7,
	0x0161, 0x00a9, 0x00aa, 0x00ab,
	0x00ac, 0x00ad, 0x00ae, 0x00af,
	0x00b0, 0x00b1, 0x00b2, 0x00b3,
	0x017d, 0x00b5, 0x00b6, 0x00b7,
	0x017e, 0x00b9, 0x00ba, 0x00bb,
	0x0152, 0x0153, 0x0178, 0x00bf,
	0x00c0, 0x00c1, 0x00c2, 0x00c3,
	0x00c4, 0x00c5, 0x00c6, 0x00c7,
	0x00c8, 0x00c9, 0x00ca, 0x00cb,
	0x00cc, 0x00cd, 0x00ce, 0x00cf,
	0x00d0, 0x00d1, 0x00d2, 0x00d3,
	0x00d4, 0x00d5, 0x00d6, 0x00d7,
	0x00d8, 0x00d9, 0x00da, 0x00db,
	0x00dc, 0x00dd, 0x00de, 0x00df,
	0x00e0, 0x00e1, 0x00e2, 0x00e3,
	0x00e4, 0x00e5, 0x00e6, 0x00e7,
	0x00e8, 0x00e9, 0x00ea, 0x00eb,
	0x00ec, 0x00ed, 0x00ee, 0x00ef,
	0x00f0, 0x00f1, 0x00f2, 0x00f3,
	0x00f4, 0x00f5, 0x00f6, 0x00f7,
	0x00f8, 0x00f9, 0x00fa, 0x00fb,
	0x00fc, 0x00fd, 0x00fe, 0x00ff,
};

static const uint16_t c2u_iso8859_2[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x0104, 0x02d8, 0x0141,
	0x00a4, 0x013d, 0x015a, 0x00a7,
	0x00a8, 0x0160, 0x015e, 0x0164,
	0x0179, 0x00ad, 0x017d, 0x017b,
	0x00b0, 0x0105, 0x02db, 0x0142,
	0x00b4, 0x013e, 0x015b, 0x02c7,
	0x00b8, 0x0161, 0x015f, 0x0165,
	0x017a, 0x02dd, 0x017e, 0x017c,
	0x0154, 0x00c1, 0x00c2, 0x0102,
	0x00c4, 0x0139, 0x0106, 0x00c7,
	0x010c, 0x00c9, 0x0118, 0x00cb,
	0x011a, 0x00cd, 0x00ce, 0x010e,
	0x0110, 0x0143, 0x0147, 0x00d3,
	0x00d4, 0x0150, 0x00d6, 0x00d7,
	0x0158, 0x016e, 0x00da, 0x0170,
	0x00dc, 0x00dd, 0x0162, 0x00df,
	0x0155, 0x00e1, 0x00e2, 0x0103,
	0x00e4, 0x013a, 0x0107, 0x00e7,
	0x010d, 0x00e9, 0x0119, 0x00eb,
	0x011b, 0x00ed, 0x00ee, 0x010f,
	0x0111, 0x0144, 0x0148, 0x00f3,
	0x00f4, 0x0151, 0x00f6, 0x00f7,
	0x0159, 0x016f, 0x00fa, 0x0171,
	0x00fc, 0x00fd, 0x0163, 0x02d9,
};

static const uint16_t c2u_iso8859_3[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x0126, 0x02d8, 0x00a3,
	0x00a4, 0x0000, 0x0124, 0x00a7,
	0x00a8, 0x0130, 0x015e, 0x011e,
	0x0134, 0x00ad, 0x0000, 0x017b,
	0x00b0, 0x0127, 0x00b2, 0x00b3,
	0x00b4, 0x00b5, 0x0125, 0x00b7,
	0x00b8, 0x0131, 0x015f, 0x011f,
	0x0135, 0x00bd, 0x0000, 0x017c,
	0x00c0, 0x00c1, 0x00c2, 0x0000,
	0x00c4, 0x010a, 0x0108, 0x00c7,
	0x00c8, 0x00c9, 0x00ca, 0x00cb,
	0x00cc, 0x00cd, 0x00ce, 0x00cf,
	0x0000, 0x00d1, 0x00d2, 0x00d3,
	0x00d4, 0x0120, 0x00d6, 0x00d7,
	0x011c, 0x00d9, 0x00da, 0x00db,
	0x00dc, 0x016c, 0x015c, 0x00df,
	0x00e0, 0x00e1, 0x00e2, 0x0000,
	0x00e4, 0x010b, 0x0109, 0x00e7,
	0x00e8, 0x00e9, 0x00ea, 0x00eb,
	0x00ec, 0x00ed, 0x00ee, 0x00ef,
	0x0000, 0x00f1, 0x00f2, 0x00f3,
	0x00f4, 0x0121, 0x00f6, 0x00f7,
	0x011d, 0x00f9, 0x00fa, 0x00fb,
	0x00fc, 0x016d, 0x015d, 0x02d9,
};

static const uint16_t c2u_iso8859_4[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x0104, 0x0138, 0x0156,
	0x00a4, 0x0128, 0x013b, 0x00a7,
	0x00a8, 0x0160, 0x0112, 0x0122,
	0x0166, 0x00ad, 0x017d, 0x00af,
	0x00b0, 0x0105, 0x02db, 0x0157,
	0x00b4, 0x0129, 0x013c, 0x02c7,
	0x00b8, 0x0161, 0x0113, 0x0123,
	0x0167, 0x014a, 0x017e, 0x014b,
	0x0100, 0x00c1, 0x00c2, 0x00c3,
	0x00c4, 0x00c5, 0x00c6, 0x012e,
	0x010c, 0x00c9, 0x0118, 0x00cb,
	0x0116, 0x00cd, 0x00ce, 0x012a,
	0x0110, 0x0145, 0x014c, 0x0136,
	0x00d4, 0x00d5, 0x00d6, 0x00d7,
	0x00d8, 0x0172, 0x00da, 0x00db,
	0x00dc, 0x0168, 0x016a, 0x00df,
	0x0101, 0x00e1, 0x00e2, 0x00e3,
	0x00e4, 0x00e5, 0x00e6, 0x012f,
	0x010d, 0x00e9, 0x0119, 0x00eb,
	0x0117, 0x00ed, 0x00ee, 0x012b,
	0x0111, 0x0146, 0x014d, 0x0137,
	0x00f4, 0x00f5, 0x00f6, 0x00f7,
	0x00f8, 0x0173, 0x00fa, 0x00fb,
	0x00fc, 0x0169, 0x016b, 0x02d9,
};

static const uint16_t c2u_iso8859_5[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x0401, 0x0402, 0x0403,
	0x0404, 0x0405, 0x0406, 0x0407,
	0x0408, 0x0409, 0x040a, 0x040b,
	0x040c, 0x00ad, 0x040e, 0x040f,
	0x0410, 0x0411, 0x0412, 0x0413,
	0x0414, 0x0415, 0x0416, 0x0417,
	0x0418, 0x0419, 0x041a, 0x041b,
	0x041c, 0x041d, 0x041e, 0x041f,
	0x0420, 0x0421, 0x0422, 0x0423,
	0x0424, 0x0425, 0x0426, 0x0427,
	0x0428, 0x0429, 0x042a, 0x042b,
	0x042c, 0x042d, 0x042e, 0x042f,
	0x0430, 0x0431, 0x0432, 0x0433,
	0x0434, 0x0435, 0x0436, 0x0437,
	0x0438, 0x0439, 0x043a, 0x043b,
	0x043c, 0x043d, 0x043e, 0x043f,
	0x0440, 0x0441, 0x0442, 0x0443,
	0x0444, 0x0445, 0x0446, 0x0447,
	0x0448, 0x0449, 0x044a, 0x044b,
	0x044c, 0x044d, 0x044e, 0x044f,
	0x2116, 0x0451, 0x0452, 0x0453,
	0x0454, 0x0455, 0x0456, 0x0457,
	0x0458, 0x0459, 0x045a, 0x045b,
	0x045c, 0x00a7, 0x045e, 0x045f,
};

static const uint16_t c2u_iso8859_6[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x0000, 0x0000, 0x0000,
	0x00a4, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x060c, 0x00ad, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x061b,
	0x0000, 0x0000, 0x0000, 0x061f,
	0x0000, 0x0621, 0x0622, 0x0623,
	0x0624, 0x0625, 0x0626, 0x0627,
	0x0628, 0x0629, 0x062a, 0x062b,
	0x062c, 0x062d, 0x062e, 0x062f,
	0x0630, 0x0631, 0x0632, 0x0633,
	0x0634, 0x0635, 0x0636, 0x0637,
	0x0638, 0x0639, 0x063a, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0640, 0x0641, 0x0642, 0x0643,
	0x0644, 0x0645, 0x0646, 0x0647,
	0x0648, 0x0649, 0x064a, 0x064b,
	0x064c, 0x064d, 0x064e, 0x064f,
	0x0650, 0x0651, 0x0652, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000,
};

static const uint16_t c2u_iso8859_7[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x02bd, 0x02bc, 0x00a3,
	0x0000, 0x0000, 0x00a6, 0x00a7,
	0x00a8, 0x00a9, 0x0000, 0x00ab,
	0x00ac, 0x00ad, 0x0000, 0x2015,
	0x00b0, 0x00b1, 0x00b2, 0x00b3,
	0x0384, 0x0385, 0x0386, 0x00b7,
	0x0388, 0x0389, 0x038a, 0x00bb,
	0x038c, 0x00bd, 0x038e, 0x038f,
	0x0390, 0x0391, 0x0392, 0x0393,
	0x0394, 0x0395, 0x0396, 0x0397,
	0x0398, 0x0399, 0x039a, 0x039b,
	0x039c, 0x039d, 0x039e, 0x039f,
	0x03a0, 0x03a1, 0x0000, 0x03a3,
	0x03a4, 0x03a5, 0x03a6, 0x03a7,
	0x03a8, 0x03a9, 0x03aa, 0x03ab,
	0x03ac, 0x03ad, 0x03ae, 0x03af,
	0x03b0, 0x03b1, 0x03b2, 0x03b3,
	0x03b4, 0x03b5, 0x03b6, 0x03b7,
	0x03b8, 0x03b9, 0x03ba, 0x03bb,
	0x03bc, 0x03bd, 0x03be, 0x03bf,
	0x03c0, 0x03c1, 0x03c2, 0x03c3,
	0x03c4, 0x03c5, 0x03c6, 0x03c7,
	0x03c8, 0x03c9, 0x03ca, 0x03cb,
	0x03cc, 0x03cd, 0x03ce, 0x0000,
};

static const uint16_t c2u_iso8859_9[128] = {
	0x0080, 0x0081, 0x0082, 0x0083,
	0x0084, 0x0085, 0x0086, 0x0087,
	0x0088, 0x0089, 0x008a, 0x008b,
	0x008c, 0x008d, 0x008e, 0x008f,
	0x0090, 0x0091, 0x0092, 0x0093,
	0x0094, 0x0095, 0x0096, 0x0097,
	0x0098, 0x0099, 0x009a, 0x009b,
	0x009c, 0x009d, 0x009e, 0x009f,
	0x00a0, 0x00a1, 0x00a2, 0x00a3,
	0x00a4, 0x00a5, 0x00a6, 0x00a7,
	0x00a8, 0x00a9, 0x00aa, 0x00ab,
	0x00ac, 0x00ad, 0x00ae, 0x00af,
	0x00b0, 0x00b1, 0x00b2, 0x00b3,
	0x00b4, 0x00b5, 0x00b6, 0x00b7,
	0x00b8, 0x00b9, 0x00ba, 0x00bb,
	0x00bc, 0x00bd, 0x00be, 0x00bf,
	0x00c0, 0x00c1, 0x00c2, 0x00c3,
	0x00c4, 0x00c5, 0x00c6, 0x00c7,
	0x00c8, 0x00c9, 0x00ca, 0x00cb,
	0x00cc, 0x00cd, 0x00ce, 0x00cf,
	0x011e, 0x00d1, 0x00d2, 0x00d3,
	0x00d4, 0x00d5, 0x00d6, 0x00d7,
	0x00d8, 0x00d9, 0x00da, 0x00db,
	0x00dc, 0x0130, 0x015e, 0x00df,
	0x00e0, 0x00e1, 0x00e2, 0x00e3,
	0x00e4, 0x00e5, 0x00e6, 0x00e7,
	0x00e8, 0x00e9, 0x00ea, 0x00eb,
	0x00ec, 0x00ed, 0x00ee, 0x00ef,
	0x011f, 0x00f1, 0x00f2, 0x00f3,
	0x00f4, 0x00f5, 0x00f6, 0x00f7,
	0x00f8, 0x00f9, 0x00fa, 0x00fb,
	0x00fc, 0x0131, 0x015f, 0x00ff,
};

static const uint16_t c2u_koi8_r[128] = {
	0x2500, 0x2502, 0x250c, 0x2510,
	0x2514, 0x2518, 0x251c, 0x2524,
	0x252c, 0x2534, 0x253c, 0x2580,
	0x2584, 0x2588, 0x258c, 0x2590,
	0x2591, 0x2592, 0x2593, 0x2320,
	0x25a0, 0x2219, 0x221a, 0x2248,
	0x2264, 0x2265, 0x00a0, 0x2321,
	0x00b0, 0x00b2, 0x00b7, 0x00f7,
	0x2550, 0x2551, 0x2552, 0x0451,
	0x2553, 0x2554, 0x2555, 0x2556,
	0x2557, 0x2558, 0x2559, 0x255a,
	0x255b, 0x255c, 0x255d, 0x255e,
	0x255f, 0x2560, 0x2561, 0x0401,
	0x2562, 0x2563, 0x2564, 0x2565,
	0x2566, 0x2567, 0x2568, 0x2569,
	0x256a, 0x256b, 0x256c, 0x00a9,
	0x044e, 0x0430, 0x0431, 0x0446,
	0x0434, 0x0435, 0x0444, 0x0433,
	0x0445, 0x0438, 0x0439, 0x043a,
	0x043b, 0x043c, 0x043d, 0x043e,
	0x043f, 0x044f, 0x0440, 0x0441,
	0x0442, 0x0443, 0x0436, 0x0432,
	0x044c, 0x044b, 0x0437, 0x0448,
	0x044d, 0x0449, 0x0447, 0x044a,
	0x042e, 0x0410, 0x0411, 0x0426,
	0x0414, 0x0415, 0x0424, 0x0413,
	0x0425, 0x0418, 0x0419, 0x041a,
	0x041b, 0x041c, 0x041d, 0x041e,
	0x041f, 0x042f, 0x0420, 0x0421,
	0x0422, 0x0423, 0x0416, 0x0412,
	0x042c, 0x042b, 0x0417, 0x0428,
	0x042d, 0x0429, 0x0427, 0x042a,
};

static const uint16_t c2u_koi8_u[128] = {
	0x2500, 0x2502, 0x250c, 0x2510,
	0x2514, 0x2518, 0x251c, 0x2524,
	0x252c, 0x2534, 0x253c, 0x2580,
	0x2584, 0x2588, 0x258c, 0x2590,
	0x2591, 0x2592, 0x2593, 0x2320,
	0x25a0, 0x2219, 0x221a, 0x2248,
	0x2264, 0x2265, 0x00a0, 0x2321,
	0x00b0, 0x00b2, 0x00b7, 0x00f7,
	0x2550, 0x2551, 0x2552, 0x0451,
	0x0454, 0x2554, 0x0456, 0x0457,
	0x2557, 0x2558, 0x2559, 0x255a,
	0x255b, 0x0491, 0x255d, 0x255e,
	0x255f, 0x2560, 0x2561, 0x0401,
	0x0404, 0x2563, 0x0406, 0x0407,
	0x2566, 0x2567, 0x2568, 0x2569,
	0x256a, 0x0490, 0x256c, 0x00a9,
	0x044e, 0x0430, 0x0431, 0x0446,
	0x0434, 0x0435, 0x0444, 0x0433,
	0x0445, 0x0438, 0x0439, 0x043a,
	0x043b, 0x043c, 0x043d, 0x043e,
	0x043f, 0x044f, 0x0440, 0x0441,
	0x0442, 0x0443, 0x0436, 0x0432,
	0x044c, 0x044b, 0x0437, 0x0448,
	0x044d, 0x0449, 0x0447, 0x044a,
	0x042e, 0x0410, 0x0411, 0x0426,
	0x0414, 0x0415, 0x0424, 0x0413,
	0x0425, 0x0418, 0x0419, 0x041a,
	0x041b, 0x041c, 0x041d, 0x041e,
	0x041f, 0x042f, 0x0420, 0x0421,
	0x0422, 0x0423, 0x0416, 0x0412,
	0x042c, 0x042b, 0x0417, 0x0428,
	0x042d, 0x0429, 0x0427, 0x042a,
};

static const struct {
	const char *name;
	const uint16_t *c2u;
} nls_list[] = {
	{ "cp1250", c2u_cp1250 },
	{ "cp1251", c2u_cp1251 },
	{ "cp1255", c2u_cp1255 },
	{ "cp437", c2u_cp437 },
	{ "cp737", c2u_cp737 },
	{ "cp775", c2u_cp775 },
	{ "cp850", c2u_cp850 },
	{ "cp852", c2u_cp852 },
	{ "cp855", c2u_cp855 },
	{ "cp857", c2u_cp857 },
	{ "cp860", c2u_cp860 },
	{ "cp861", c2u_cp861 },
	{ "cp862", c2u_cp862 },
	{ "cp863", c2u_cp863 },
	{ "cp864", c2u_cp864 },
	{ "cp865", c2u_cp865 },
	{ "cp866", c2u_cp866 },
	{ "cp869", c2u_cp869 },
	{ "cp874", c2u_cp874 },
	{ "iso88591", c2u_iso8859_1 },
	{ "iso885913", c2u_iso8859_13 },
	{ "iso885914", c2u_iso8859_14 },
	{ "iso885915", c2u_iso8859_15 },
	{ "iso88592", c2u_iso8859_2 },
	{ "iso88593", c2u_iso8859_3 },
	{ "iso88594", c2u_iso8859_4 },
	{ "iso88595", c2u_iso8859_5 },
	{ "iso88596", c2u_iso8859_6 },
	{ "iso88597", c2u_iso8859_7 },
	{ "iso88599", c2u_iso8859_9 },
	{ "koi8r", c2u_koi8_r },
	{ "koi8u", c2u_koi8_u },
	{ NULL, NULL },
};

static uint16_t *c2u_table = NULL;
static unsigned char *u2c_table = NULL;
static size_t u2c_table_size = 0;

int init_charset (const char* name) 
{
        size_t lname;
	char *sname;
	int i, j;
	char* p;

	if (c2u_table) free(c2u_table);
	if (u2c_table) free(u2c_table);
	c2u_table = NULL;
	u2c_table = NULL;
	u2c_table_size = 0;

	lname = strlen(name);
	p = sname = malloc (lname+1);
	for (i=0; i<lname; i++) {
		if (isalnum(name[i])) 
			*p++ = tolower (name[i]);
	}
	*p = '\0';

	if (strcmp(sname, "utf8") == 0) {
		return 1;
	}
	
	for (i=0; nls_list[i].name != NULL; i++) {
		if (strcmp(sname, nls_list[i].name) == 0) {
		        uint16_t c;
		        u2c_table_size = 128;
			for (j=0; j<128; j++) {
				c = nls_list[i].c2u[j];
				if (c > u2c_table_size)
					u2c_table_size = c;
			}
			u2c_table_size++;
			c2u_table = (uint16_t *)malloc(256 * 2);
			u2c_table = (unsigned char *)malloc(u2c_table_size);
			memset(u2c_table, '?', u2c_table_size);
			for (j=0; j<128; j++) {
				c2u_table[j] = (uint16_t)j;
				u2c_table[j] = (unsigned char)j;
			}

			for (j=128; j<256; j++) {
				c = nls_list[i].c2u[j-128];
				c2u_table[j] = c;
				u2c_table[c] = (unsigned char)j;
			}
			return 1;
		}
	}
	return 0;
}


size_t utf2ascii_size (const char* src) 
{
  size_t size = 0;
  if (src) {
    if (u2c_table == NULL) {
      // no conversion
      size = strlen (src);
    } else {
      /*
       * Convert UTF-8 to selected charset : result string will be at most of 
       * the same length because choosen charset are all 8-bits.
       */
      while (*src) {
	unsigned char const c = (unsigned char) *(src++);
	// Skip all continuation bytes
	if ( ( c & 0xc0) != 0x80 ) 
	  size++;
      }
    }
    size += 1; // Add space for final '\0'
  }
  return size;
}


char *utf2ascii (const char *src, char *dest, size_t size) 
{
  char *p = dest;
  int n = 0;
  
  // Set size to max. number of characters = buffer size minus final '\0'
  size -= 1;
  
  if (u2c_table == NULL) {
    strncpy (dest, src, size);
    dest[size] = '\0';
    return dest;
  }
  
  while (*src && n < size) {
    unsigned char const c = (unsigned char) *(src++);
    uint16_t s;
    if (c == 0) break;
    if (c <= 0x7f) {
      s = c;
    } else if (c >= 0xc0 && c <= 0xdf && (*src & 0xc0) == 0x80) {
      s = ((c & 0x1f) << 6) | (*(src++) & 0x3f);
    } else if (c >= 0xe0 && c <= 0xef &&
	       (*src & 0xc0) == 0x80 && (*(src+1) & 0xc0) == 0x80) {
      s = ((c & 0x0f) << 12) | ((*(src++) & 0x3f) << 6);
      s |= (*(src++) & 0x3f);
    } else {
      s = '?';
    }   
    *(dest++) = (s < u2c_table_size ? u2c_table[s] : '?');
    n++;
  }
  *dest = '\0';
  return p;
}


size_t ascii2utf_size (const char* src) 
{
  size_t size = 0;
  if (src) {
    if (c2u_table == NULL) {
      // No conversion
      size = strlen (src);
    } else {
      /*
       * Convert selected charset to UTF-8 : in theory, the result string 
       * could be as long as 6 times the original length. However the choosen 
       * 8-bits charsets have values between U+00000800 and U+0000FFFF so this
       * gives at most a 3-bytes UTF-8 character.
       */
      while (*src) {
	unsigned char const c = (unsigned char) *(src++);
	size += ((c <= 0x7f) ? 1 : 3);
      }
    }
    size += 1; // Add space for final '\0'
  }
  return size;
}


char *ascii2utf (const char *src, char *dest, size_t size) 
{
  char *p = dest;
  int n = 0;

  // Set size to max. number of characters = buffer size minus final '\0'
  size -= 1;
	
  if (c2u_table == NULL) {
    strncpy(dest, src, size);
    dest[size] = '\0';
    return dest;
  }

  while (*src && n < size) {
    unsigned char const c = (unsigned char) *(src++);
    uint16_t const s = c2u_table[c];
    if (s <= 0x7f) {
      *(dest++) = (char)s;
      n++;
    } else if (s <= 0x7ff) {
      if (n >= size-1)
	break;
      *(dest++) = (char)(0xc0 | (s >> 6));
      *(dest++) = (char)(0x80 | (s & 0x3f));
      n += 2;
    } else {
      if (n >= size-2)
	break;
      *(dest++) = (char)(0xe0 | (s >> 12));
      *(dest++) = (char)(0x80 | ((s >> 6) & 0x3f));
      *(dest++) = (char)(0x80 | (s & 0x3f));
      n += 3;
    }
  }
  *dest = '\0';
  return p;
}

